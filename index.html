<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Plane Shooter Game</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #000;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        #gameContainer {
            flex: 1;
            position: relative;
        }
        canvas {
            display: block;
            width: 100%;
            height: 100%;
            background: url('figures/background.png') no-repeat center center;
            background-size: cover;
        }
        .controls {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background-color: rgba(0, 0, 0, 0.8);
        }
        .direction-controls {
            display: grid;
            grid-template-areas:
                ". up ."
                "left down right";
            gap: 10px;
            justify-items: center;
            align-items: center;
        }
        #up { grid-area: up; }
        #left { grid-area: left; }
        #right { grid-area: right; }
        #down { grid-area: down; }

        .shoot-control {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10vw;
            width: 100%;
        }
        .btn {
            width: 12vw;
            height: 12vw;
            max-width: 50px;
            max-height: 50px;
            background-color: rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4vw;
            user-select: none;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas"></canvas>
    </div>
    <div class="controls">
        <div class="direction-controls">
            <div class="btn" id="up">üîº</div>
            <div class="btn" id="left">‚óÄÔ∏è</div>
            <div class="btn" id="right">‚ñ∂Ô∏è</div>
            <div class="btn" id="down">üîΩ</div>
        </div>
        <div class="shoot-control">
            <div class="btn" id="shoot">üî´</div>
        </div>
    </div>

    <audio id="backgroundMusic" src="audio/background.mp3" loop autoplay></audio>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        function resizeCanvas() {
            canvas.width = document.getElementById('gameContainer').clientWidth;
            canvas.height = document.getElementById('gameContainer').clientHeight;
        }

        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        const PLAYER_SPEED = 5;
        const BULLET_SPEED = 7;
        let ENEMY_MIN_SPEED = 2;
        let ENEMY_MAX_SPEED = 5;
        let ENEMY_SPAWN_TIME = 1000;
        let ENEMY_HEALTH_MULTIPLIER = 1;

        let score = 0;
        let gameOver = false;
        let keys = {};
        let foodCount = 0;
        let cycleStartTime = Date.now();

        const playerImg = new Image();
        playerImg.src = 'figures/player.png';

        const cryImg = new Image();
        cryImg.src = 'figures/cry.jpg';

        const bulletImg = new Image();
        bulletImg.src = 'figures/bullet.png';

        const enemyImg1 = new Image();
        enemyImg1.src = 'figures/enemy1.jpg';

        const enemyImg2 = new Image();
        enemyImg2.src = 'figures/enemy2.jpg';

        const boomImg = new Image();
        boomImg.src = 'figures/boom.jpg';

        const foodImg = new Image();
        foodImg.src = 'figures/food.jpg';

        class Player {
            constructor() {
                this.width = 50;
                this.height = 60;
                this.x = canvas.width / 2 - this.width / 2;
                this.y = canvas.height - this.height - 10;
                this.powerUp = false;
                this.hitOnce = false;
                this.extraLife = 0;
                this.invincible = false;
                this.image = playerImg;
                this.cryDisplayed = false;
            }

            draw() {
                ctx.drawImage(this.image, this.x, this.y, this.width, this.height);
            }

            move() {
                if (!gameOver) {
                    if (keys['ArrowLeft'] && this.x > 0) this.x -= PLAYER_SPEED;
                    if (keys['ArrowRight'] && this.x < canvas.width - this.width) this.x += PLAYER_SPEED;
                    if (keys['ArrowUp'] && this.y > 0) this.y -= PLAYER_SPEED;
                    if (keys['ArrowDown'] && this.y < canvas.height - this.height) this.y += PLAYER_SPEED;
                }
            }

            downgrade() {
                if (this.extraLife > 0) {
                    this.extraLife--;
                    this.powerUp = false;
                    foodCount = 0;
                    this.invincible = true;
                    setTimeout(() => this.invincible = false, 2000);
                } else if (this.powerUp) {
                    this.powerUp = false;
                } else if (!this.hitOnce) {
                    this.hitOnce = true;
                } else {
                    if (!this.cryDisplayed) {
                        this.image = cryImg;
                        this.cryDisplayed = true;
                    }
                    gameOver = true;
                }
            }
        }

        class Bullet {
            constructor(x, y, direction = 0) {
                this.x = x;
                this.y = y;
                this.width = 10;
                this.height = 20;
                this.direction = direction;
            }

            draw() {
                ctx.drawImage(bulletImg, this.x, this.y, this.width, this.height);
            }

            update() {
                this.y -= BULLET_SPEED;
                if (this.direction === -1) this.x -= 2;
                if (this.direction === 1) this.x += 2;
                if (this.direction === -2) this.x -= 4;
                if (this.direction === 2) this.x += 4;
                if (this.direction === -3) this.x -= 6;
                if (this.direction === 3) this.x += 6;
            }
        }

        class Enemy {
            constructor() {
                const type = Math.random() > 0.3 ? enemyImg2 : enemyImg1; // Increase enemy2 frequency
                this.image = type;
                this.width = type === enemyImg1 ? 70 : 30;
                this.height = type === enemyImg1 ? 85 : 35;
                this.x = Math.random() * (canvas.width - this.width);
                this.y = -this.height;
                this.speedY = Math.random() * (ENEMY_MAX_SPEED - ENEMY_MIN_SPEED) + ENEMY_MIN_SPEED;
                this.speedX = Math.random() > 0.5 ? 2 : -2;
                this.health = (type === enemyImg1 ? 3 : 1) * ENEMY_HEALTH_MULTIPLIER;
                this.scoreValue = type === enemyImg1 ? 20 : 5;
                this.exploding = false;
                this.explodeTimer = 10;
            }

            draw() {
                if (this.exploding) {
                    const size = this.width === 100 ? [100, 100] : [40, 40];
                    ctx.drawImage(boomImg, this.x, this.y, ...size);
                } else {
                    ctx.drawImage(this.image, this.x, this.y, this.width, this.height);
                }
            }

            update() {
                if (!this.exploding) {
                    this.y += this.speedY;
                    this.x += this.speedX;
                    if (this.x <= 0 || this.x + this.width >= canvas.width) this.speedX *= -1;
                    if (this.y > canvas.height) this.exploding = true;
                } else {
                    this.explodeTimer--;
                }
            }

            hit() {
                this.health--;
                if (this.health <= 0) this.exploding = true;
            }
        }

        class Food {
            constructor() {
                this.width = 30;
                this.height = 30;
                this.x = Math.random() * (canvas.width - this.width);
                this.y = Math.random() * (canvas.height / 2);
                this.speedX = Math.random() > 0.5 ? 2 : -2;
                this.speedY = Math.random() * 2 + 1;
            }

            draw() {
                ctx.drawImage(foodImg, this.x, this.y, this.width, this.height);
            }

            update() {
                this.x += this.speedX;
                this.y += this.speedY;
                if (this.x <= 0 || this.x + this.width >= canvas.width) this.speedX *= -1;
                if (this.y > canvas.height) foods.splice(foods.indexOf(this), 1);
            }
        }

        const player = new Player();
        const bullets = [];
        const enemies = [];
        const foods = [];

        function gameLoop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            player.draw();
            player.move();

            bullets.forEach((bullet, bulletIndex) => {
                bullet.update();
                bullet.draw();

                enemies.forEach((enemy, enemyIndex) => {
                    if (checkCollision(bullet, enemy) && !enemy.exploding) {
                        enemy.hit();
                        bullets.splice(bulletIndex, 1);
                        if (enemy.exploding) {
                            score += enemy.scoreValue;
                        }
                    }
                });

                if (bullet.y + bullet.height < 0) bullets.splice(bulletIndex, 1);
            });

            enemies.forEach((enemy, index) => {
                enemy.update();
                enemy.draw();
                if (enemy.exploding && enemy.explodeTimer <= 0) {
                    enemies.splice(index, 1);
                }
                if (checkCollision(player, enemy) && !player.invincible) {
                    player.downgrade();
                    if (gameOver) player.draw();
                }
            });

            foods.forEach((food, index) => {
                food.update();
                food.draw();
                if (checkCollision(player, food)) {
                    foodCount++;
                    if (foodCount === 1) {
                        player.powerUp = true;
                    } else if (foodCount === 2) {
                        player.extraLife = 1;
                    } else {
                        score += 100;
                    }
                    foods.splice(index, 1);
                }
            });

            ctx.fillStyle = 'white';
            ctx.font = '20px Arial';
            ctx.fillText(`Score: ${score}`, 10, 30);

            if (!gameOver) requestAnimationFrame(gameLoop);
            else showGameOver();
        }

        function checkCollision(obj1, obj2) {
            return obj1.x < obj2.x + obj2.width && obj1.x + obj1.width > obj2.x &&
                   obj1.y < obj2.y + obj2.height && obj1.y + obj1.height > obj2.y;
        }

        function showGameOver() {
            ctx.fillStyle = 'red';
            ctx.font = '40px Arial';
            ctx.fillText('Game Over', canvas.width / 2 - 100, canvas.height / 2);
        }

        setInterval(() => {
            enemies.push(new Enemy());
        }, ENEMY_SPAWN_TIME);

        setInterval(() => {
            if (Math.random() < 0.3) foods.push(new Food());
        }, 7000);

        setInterval(() => {
            const elapsed = (Date.now() - cycleStartTime) / 1000;

            if (elapsed % 240 < 60) { // Increase speed and spawn rate every minute for 4-minute cycle
                ENEMY_MIN_SPEED = 3;
                ENEMY_MAX_SPEED = 7.5;
                ENEMY_SPAWN_TIME = 667; // 150% spawn rate
            } else if (elapsed % 240 >= 60 && elapsed % 240 < 240) {
                ENEMY_MIN_SPEED = 2;
                ENEMY_MAX_SPEED = 5;
                ENEMY_SPAWN_TIME = 1000;
            }

            if (elapsed % 480 >= 240 && elapsed % 480 < 480) { // Increase health every 4 minutes, reset after 8 minutes
                ENEMY_HEALTH_MULTIPLIER = 2;
            } else {
                ENEMY_HEALTH_MULTIPLIER = 1;
            }
        }, 1000);

        window.addEventListener('keydown', (e) => {
            keys[e.key] = true;
            if (e.key === ' ' && !gameOver) {
                shoot();
            }
        });

        window.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });

        document.getElementById('left').addEventListener('touchstart', () => keys['ArrowLeft'] = true);
        document.getElementById('left').addEventListener('touchend', () => keys['ArrowLeft'] = false);

        document.getElementById('right').addEventListener('touchstart', () => keys['ArrowRight'] = true);
        document.getElementById('right').addEventListener('touchend', () => keys['ArrowRight'] = false);

        document.getElementById('up').addEventListener('touchstart', () => keys['ArrowUp'] = true);
        document.getElementById('up').addEventListener('touchend', () => keys['ArrowUp'] = false);

        document.getElementById('down').addEventListener('touchstart', () => keys['ArrowDown'] = true);
        document.getElementById('down').addEventListener('touchend', () => keys['ArrowDown'] = false);

        document.getElementById('shoot').addEventListener('touchstart', () => shoot());

        function shoot() {
            if (foodCount >= 2) {
                bullets.push(new Bullet(player.x + player.width / 2, player.y, -3));
                bullets.push(new Bullet(player.x + player.width / 2, player.y, -2));
                bullets.push(new Bullet(player.x + player.width / 2, player.y, -1));
                bullets.push(new Bullet(player.x + player.width / 2, player.y, 0));
                bullets.push(new Bullet(player.x + player.width / 2, player.y, 1));
                bullets.push(new Bullet(player.x + player.width / 2, player.y, 2));
                bullets.push(new Bullet(player.x + player.width / 2, player.y, 3));
            } else if (player.powerUp) {
                bullets.push(new Bullet(player.x + player.width / 2, player.y, -1));
                bullets.push(new Bullet(player.x + player.width / 2, player.y, 0));
                bullets.push(new Bullet(player.x + player.width / 2, player.y, 1));
            } else {
                bullets.push(new Bullet(player.x + player.width / 2, player.y));
            }
        }

        gameLoop();
    </script>
</body>
</html>
