<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Plane Shooter Game</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #000;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        #gameContainer {
            flex: 1;
            position: relative;
        }
        canvas {
            display: block;
            width: 100%;
            height: 100%;
            background: url('figures/background.png') no-repeat center center;
            background-size: cover;
        }
        .controls {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background-color: rgba(0, 0, 0, 0.8);
        }
        .direction-controls {
            display: grid;
            grid-template-areas:
                ". up ."
                "left down right";
            gap: 10px;
            justify-items: center;
            align-items: center;
        }
        #up { grid-area: up; }
        #left { grid-area: left; }
        #right { grid-area: right; }
        #down { grid-area: down; }

        .shoot-control {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10vw;
            width: 100%;
        }
        .btn {
            width: 12vw;
            height: 12vw;
            max-width: 50px;
            max-height: 50px;
            background-color: rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4vw;
            user-select: none;
        }
        /* åœ¨è¿™é‡ŒæŠŠå°„å‡»æŒ‰é’®è°ƒå¤§ä¸€äº› */
        #shoot.btn {
            width: 16vw;
            height: 16vw;
            max-width: 80px;
            max-height: 80px;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas"></canvas>
    </div>
    <div class="controls">
        <div class="direction-controls">
            <div class="btn" id="up">ğŸ’€</div>
            <div class="btn" id="left">â—€ï¸</div>
            <div class="btn" id="right">â–¶ï¸</div>
            <div class="btn" id="down">ğŸ”»</div>
        </div>
        <div class="shoot-control">
            <div class="btn" id="shoot">ğŸ”«</div>
        </div>
    </div>

    <audio id="backgroundMusic" src="audio/background.mp3" loop></audio>

    <script>
        // ============================== éŸ³ä¹æ’­æ”¾æ§åˆ¶ ==============================
        document.addEventListener('DOMContentLoaded', () => {
            const music = document.getElementById('backgroundMusic');
            // éœ€è¦ç”¨æˆ·äº¤äº’åæ‰èƒ½è‡ªåŠ¨æ’­æ”¾
            document.addEventListener('click', () => {
                music.play();
            }, { once: true });
            document.addEventListener('touchstart', () => {
                music.play();
            }, { once: true });
        });

        // ============================== ç”»å¸ƒ & åˆå§‹åŒ– ==============================
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        function resizeCanvas() {
            canvas.width = document.getElementById('gameContainer').clientWidth;
            canvas.height = document.getElementById('gameContainer').clientHeight;
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        // ============================== å¸¸é‡ & å˜é‡ ==============================
        const PLAYER_SPEED = 5;
        const BULLET_SPEED = 7;

        let ENEMY_MIN_SPEED = 2;
        let ENEMY_MAX_SPEED = 5;
        let ENEMY_SPAWN_TIME = 1000;
        let ENEMY_HEALTH_MULTIPLIER = 1;

        let score = 0;
        let gameOver = false;
        let keys = {};

        // åƒ food è®¡æ•°ï¼ˆ0 è¡¨ç¤ºæ²¡åƒï¼Œ1 è¡¨ç¤ºåƒä¸€æ¬¡ï¼Œ2 è¡¨ç¤ºåƒä¸¤æ¬¡ï¼Œ2+ ä¹‹åç«åŠ›æ›´å¼ºï¼‰
        let foodCount = 0;  
        let cycleStartTime = Date.now();

        // ä¿è¯é£Ÿç‰©/ç”Ÿå‘½å¿…ç„¶å‡ºç°çš„æ—¶é—´è®°å½•
        let lastFoodSpawnTime = Date.now();
        let lastLifeSpawnTime = Date.now();

        // ============================== è½½å…¥å›¾ç‰‡ ==============================
        const playerImg = new Image();
        playerImg.src = 'figures/player.png';

        const cryImg = new Image();
        cryImg.src = 'figures/cry.jpg';

        const bulletImg = new Image();
        bulletImg.src = 'figures/bullet.png';

        const enemyImg1 = new Image();
        enemyImg1.src = 'figures/enemy1.jpg';

        const enemyImg2 = new Image();
        enemyImg2.src = 'figures/enemy2.jpg';

        // æ–°å¢ enemy3 / enemy4
        const enemyImg3 = new Image();
        enemyImg3.src = 'figures/enemy3.jpg';

        const enemyImg4 = new Image();
        enemyImg4.src = 'figures/enemy4.jpg';

        const boomImg = new Image();
        boomImg.src = 'figures/boom.jpg';

        const foodImg = new Image();
        foodImg.src = 'figures/food.jpg';

        const lifeImg = new Image();
        lifeImg.src = 'figures/life.jpg';

        // æ–°å¢ angry å›¾ã€boss å›¾
        const angryImg = new Image();
        angryImg.src = 'figures/angry.jpg';

        const bossImg = new Image();
        bossImg.src = 'figures/boss.jpg';

        // ============================== å®šæ—¶å™¨/æ•°ç»„ ==============================
        let enemySpawnInterval;
        const bullets = [];
        const enemies = [];
        const foods = [];
        const lifes = [];
        const bosses = []; // ç”¨æ¥å­˜å‚¨ boss

        // ============================== ç±»å®šä¹‰ ==============================
        class Player {
            constructor() {
                this.width = 50;
                this.height = 60;
                this.x = canvas.width / 2 - this.width / 2;
                this.y = canvas.height - this.height - 10;

                this.powerUp = false;  // æ˜¯å¦ç«åŠ›åŠ å¼ºï¼ˆç¬¬ä¸€æ¬¡åƒ foodï¼‰
                this.hitOnce = false;  // æ˜¯å¦å·²ç»è¢«æ‰“ä¸€æ¬¡
                this.extraLife = 0;    // é¢å¤–å‘½
                this.invincible = false;
                this.cryDisplayed = false;

                this.image = playerImg; // é»˜è®¤å›¾
            }

            draw() {
                ctx.drawImage(this.image, this.x, this.y, this.width, this.height);
            }

            move() {
                if (gameOver) return;
                if (keys['ArrowLeft'] && this.x > 0) this.x -= PLAYER_SPEED;
                if (keys['ArrowRight'] && this.x < canvas.width - this.width) this.x += PLAYER_SPEED;
                if (keys['ArrowUp'] && this.y > 0) this.y -= PLAYER_SPEED;
                if (keys['ArrowDown'] && this.y < canvas.height - this.height) this.y += PLAYER_SPEED;
            }

            downgrade() {
                if (this.extraLife > 0) {
                    // å¦‚æœè¿˜æœ‰é¢å¤–å‘½ï¼Œå‡ä¸€æ¡é¢å¤–å‘½
                    this.extraLife--;
                    // å¤±å»é¢å¤–å‘½åŒæ—¶å–æ¶ˆç«åŠ›åŠ å¼º
                    this.powerUp = false;
                    foodCount = 0;
                    this.image = playerImg; // æ¢å¤æˆæ™®é€šç©å®¶å›¾
                    // æ— æ•Œä¿æŠ¤ 2 ç§’
                    this.invincible = true;
                    setTimeout(() => this.invincible = false, 2000);
                } else if (this.powerUp) {
                    // å¦‚æœåªæ˜¯åœ¨ç«åŠ›åŠ å¼ºçŠ¶æ€ï¼Œåˆ™å–æ¶ˆ
                    this.powerUp = false;
                    this.image = playerImg;
                } else if (!this.hitOnce) {
                    // ç¬¬ä¸€æ¬¡è¢«æ‰“ï¼Œä¸æ¸¸æˆç»“æŸï¼Œä½†æ ‡è®° hitOnce
                    this.hitOnce = true;
                } else {
                    // ç¬¬äºŒæ¬¡è¢«æ‰“ => gameOver
                    if (!this.cryDisplayed) {
                        this.image = cryImg;
                        this.cryDisplayed = true;
                    }
                    gameOver = true;
                }
            }
        }

        class Bullet {
            constructor(x, y, direction = 0) {
                this.x = x;
                this.y = y;
                this.width = 10;
                this.height = 20;
                this.direction = direction; // å­å¼¹å·¦å³æ‰©æ•£æ–¹å‘
            }

            draw() {
                ctx.drawImage(bulletImg, this.x, this.y, this.width, this.height);
            }

            update() {
                this.y -= BULLET_SPEED;
                if (this.direction === -3) this.x -= 6;
                if (this.direction === -2) this.x -= 4;
                if (this.direction === -1) this.x -= 2;
                if (this.direction === 1)  this.x += 2;
                if (this.direction === 2)  this.x += 4;
                if (this.direction === 3)  this.x += 6;
            }
        }

        class Enemy {
            constructor() {
                // éšæœºå†³å®šæ˜¯å“ªä¸€ç§æ•Œæœºï¼ˆ1ã€2ã€3ã€4ï¼‰
                const rnd = Math.floor(Math.random() * 4);
                switch (rnd) {
                    case 0: // enemy1
                        this.image = enemyImg1;
                        this.width = 70;
                        this.height = 85;
                        this.health = 3 * ENEMY_HEALTH_MULTIPLIER;
                        this.scoreValue = 20;
                        break;
                    case 1: // enemy2
                        this.image = enemyImg2;
                        this.width = 30;
                        this.height = 35;
                        this.health = 1 * ENEMY_HEALTH_MULTIPLIER;
                        this.scoreValue = 5;
                        break;
                    case 2: // enemy3 (ä¸ enemy2 åŒå¤§å°ã€è¡€é‡ã€åˆ†å€¼)
                        this.image = enemyImg3;
                        this.width = 30;
                        this.height = 35;
                        this.health = 1 * ENEMY_HEALTH_MULTIPLIER;
                        this.scoreValue = 5;
                        break;
                    case 3: // enemy4 (ä¸ enemy1 åŒå¤§å°ã€è¡€é‡ã€åˆ†å€¼)
                    default:
                        this.image = enemyImg4;
                        this.width = 70;
                        this.height = 85;
                        this.health = 3 * ENEMY_HEALTH_MULTIPLIER;
                        this.scoreValue = 20;
                        break;
                }

                this.x = Math.random() * (canvas.width - this.width);
                this.y = -this.height;
                this.speedY = Math.random() * (ENEMY_MAX_SPEED - ENEMY_MIN_SPEED) + ENEMY_MIN_SPEED;
                this.speedX = Math.random() > 0.5 ? 2 : -2;
                this.exploding = false;
                this.explodeTimer = 10;
            }

            draw() {
                if (this.exploding) {
                    // çˆ†ç‚¸åŠ¨ç”»
                    const size = [this.width > 50 ? 100 : 40, this.width > 50 ? 100 : 40];
                    ctx.drawImage(boomImg, this.x, this.y, ...size);
                } else {
                    ctx.drawImage(this.image, this.x, this.y, this.width, this.height);
                }
            }

            update() {
                if (!this.exploding) {
                    this.y += this.speedY;
                    this.x += this.speedX;
                    if (this.x <= 0 || this.x + this.width >= canvas.width) {
                        this.speedX *= -1;
                    }
                    // è¶…è¿‡ä¸‹è¾¹ç•Œåç§»é™¤
                    if (this.y > canvas.height) {
                        this.exploding = true;
                    }
                } else {
                    this.explodeTimer--;
                }
            }

            hit() {
                this.health--;
                if (this.health <= 0) {
                    this.exploding = true;
                }
            }
        }

        class Food {
            constructor() {
                this.width = 30;
                this.height = 30;
                this.x = Math.random() * (canvas.width - this.width);
                // åœ¨å±å¹•ä¸ŠåŠåŒºåŸŸéšæœºå‡ºç°
                this.y = Math.random() * (canvas.height / 2);
                this.speedX = Math.random() > 0.5 ? 2 : -2;
                this.speedY = Math.random() * 2 + 1;
            }

            draw() {
                ctx.drawImage(foodImg, this.x, this.y, this.width, this.height);
            }

            update() {
                this.x += this.speedX;
                this.y += this.speedY;
                if (this.x <= 0 || this.x + this.width >= canvas.width) {
                    this.speedX *= -1;
                }
                if (this.y > canvas.height) {
                    foods.splice(foods.indexOf(this), 1);
                }
            }
        }

        class Life {
            constructor() {
                this.width = 30;
                this.height = 30;
                this.x = Math.random() * (canvas.width - this.width);
                this.y = -this.height; // ä»é¡¶éƒ¨å‡ºç°
                this.speedX = 0;
                this.speedY = 2;
            }

            draw() {
                ctx.drawImage(lifeImg, this.x, this.y, this.width, this.height);
            }

            update() {
                this.y += this.speedY;
                if (this.y > canvas.height) {
                    lifes.splice(lifes.indexOf(this), 1);
                }
            }
        }

        // ============================== Boss ç±» ==============================
        class Boss {
            constructor() {
                this.image = bossImg;
                this.width = 150;
                this.height = 150;
                this.x = Math.random() * (canvas.width - this.width);
                this.y = -this.height;  // ä»ä¸Šæ–¹å‡ºç°
                this.health = 20;       // éœ€è¦ 20 å‘å­å¼¹å‡»ä¸­
                this.speedX = (Math.random() > 0.5 ? 2 : -2); 
                this.speedY = 2;        // å¯ä»¥ä¸Šä¸‹ç§»åŠ¨
                this.exploding = false;
                this.explodeTimer = 15;
                this.scoreValue = 500;  // å‡»æ€ boss åçš„åˆ†æ•°å¥–åŠ±ï¼ˆå¯è‡ªè¡Œè®¾å®šï¼‰
            }

            draw() {
                if (this.exploding) {
                    // çˆ†ç‚¸å°ºå¯¸æ›´å¤§ä¸€äº›
                    ctx.drawImage(boomImg, this.x, this.y, 180, 180);
                } else {
                    ctx.drawImage(this.image, this.x, this.y, this.width, this.height);
                }
            }

            update() {
                if (!this.exploding) {
                    this.x += this.speedX;
                    this.y += this.speedY;

                    // å·¦å³è¾¹ç•Œåå¼¹
                    if (this.x <= 0 || this.x + this.width >= canvas.width) {
                        this.speedX *= -1;
                    }
                    // ä¸Šä¸‹è¾¹ç•Œåå¼¹ï¼ˆåŒ…æ‹¬é¡¶éƒ¨å’Œåº•éƒ¨ï¼‰
                    if (this.y <= 0 || this.y + this.height >= canvas.height) {
                        this.speedY *= -1;
                    }
                } else {
                    this.explodeTimer--;
                }
            }

            hit() {
                this.health--;
                if (this.health <= 0) {
                    this.exploding = true;
                }
            }
        }

        // ============================== å®ä¾‹åŒ–ç©å®¶ ==============================
        const player = new Player();

        // ============================== æ•Œæœºåˆ·æ–° ==============================
        function updateEnemySpawn() {
            clearInterval(enemySpawnInterval);
            enemySpawnInterval = setInterval(() => {
                enemies.push(new Enemy());
            }, ENEMY_SPAWN_TIME);
        }

        // ============================== æ¸¸æˆä¸»å¾ªç¯ ==============================
        function gameLoop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // 1. ç»˜åˆ¶ç©å®¶ & ç§»åŠ¨
            player.draw();
            player.move();

            // 2. å­å¼¹æ›´æ–° & ä¸æ•Œæœº/boss ç¢°æ’
            bullets.forEach((bullet, bulletIndex) => {
                bullet.update();
                bullet.draw();

                // (a) å­å¼¹ä¸æ™®é€šæ•Œæœºçš„ç¢°æ’
                enemies.forEach((enemy, enemyIndex) => {
                    if (checkCollision(bullet, enemy) && !enemy.exploding) {
                        enemy.hit();
                        bullets.splice(bulletIndex, 1);
                        if (enemy.exploding) {
                            score += enemy.scoreValue;
                        }
                    }
                });

                // (b) å­å¼¹ä¸ boss çš„ç¢°æ’
                bosses.forEach((boss, bossIndex) => {
                    if (checkCollision(bullet, boss) && !boss.exploding) {
                        boss.hit();
                        bullets.splice(bulletIndex, 1);
                        if (boss.exploding) {
                            // boss çˆ†ç‚¸å¼€å§‹æ—¶å…ˆåŠ åˆ†
                            score += boss.scoreValue;
                        }
                    }
                });

                // (c) å­å¼¹é£å‡ºå±å¹•åˆ™ç§»é™¤
                if (bullet.y + bullet.height < 0) {
                    bullets.splice(bulletIndex, 1);
                }
            });

            // 3. æ•Œæœºæ›´æ–° & ç¢°æ’
            enemies.forEach((enemy, index) => {
                enemy.update();
                enemy.draw();
                // çˆ†ç‚¸ç»“æŸåç§»é™¤
                if (enemy.exploding && enemy.explodeTimer <= 0) {
                    enemies.splice(index, 1);
                }
                // ä¸ç©å®¶ç¢°æ’
                if (!player.invincible && checkCollision(player, enemy)) {
                    player.downgrade();
                    if (gameOver) player.draw();
                }
            });

            // 4. boss æ›´æ–° & ç¢°æ’
            bosses.forEach((boss, index) => {
                boss.update();
                boss.draw();
                // boss çˆ†ç‚¸ç»“æŸåç§»é™¤
                if (boss.exploding && boss.explodeTimer <= 0) {
                    bosses.splice(index, 1);
                }
                // ä¸ç©å®¶ç¢°æ’
                if (!player.invincible && checkCollision(player, boss) && !boss.exploding) {
                    player.downgrade();
                    if (gameOver) player.draw();
                }
            });

            // 5. foodï¼ˆç«åŠ›é“å…·ï¼‰æ›´æ–° & ç¢°æ’
            foods.forEach((food, index) => {
                food.update();
                food.draw();
                if (checkCollision(player, food)) {
                    foodCount++;
                    // ç¬¬ä¸€æ¬¡åƒ => fire up
                    // ç¬¬äºŒæ¬¡åƒ => +1å‘½ & angryå›¾
                    // ç¬¬ä¸‰æ¬¡+ => +100åˆ†
                    if (foodCount === 1) {
                        player.powerUp = true;
                    } else if (foodCount === 2) {
                        player.extraLife = 1;
                        player.image = angryImg; // æ¢æˆ angry
                    } else {
                        score += 100;
                    }
                    foods.splice(index, 1);
                }
            });

            // 6. lifeï¼ˆåŠ å‘½é“å…·ï¼‰æ›´æ–° & ç¢°æ’
            lifes.forEach((lifeItem, index) => {
                lifeItem.update();
                lifeItem.draw();
                if (checkCollision(player, lifeItem)) {
                    player.extraLife++;
                    lifes.splice(index, 1);
                }
            });

            // 7. æ˜¾ç¤ºåˆ†æ•°å’Œç”Ÿå‘½
            ctx.fillStyle = 'white';
            ctx.font = '20px Arial';
            ctx.fillText(`Score: ${score}`, 10, 30);
            ctx.fillText(`Life: ${player.extraLife + 1}`, 10, 60);

            // 8. åˆ¤æ–­æ¸¸æˆæ˜¯å¦ç»“æŸ
            if (!gameOver) {
                requestAnimationFrame(gameLoop);
            } else {
                showGameOver();
            }
        }

        function checkCollision(obj1, obj2) {
            return (
                obj1.x < obj2.x + obj2.width &&
                obj1.x + obj1.width > obj2.x &&
                obj1.y < obj2.y + obj2.height &&
                obj1.y + obj2.height > obj1.y
            );
        }

        function showGameOver() {
            ctx.fillStyle = 'red';
            ctx.font = '40px Arial';
            ctx.fillText('Game Over', canvas.width / 2 - 100, canvas.height / 2);
        }

        // ========== ã€é£Ÿç‰© & ç”Ÿå‘½é“å…·ã€‘éšæœºå‡ºç° + ä¿è¯ä¸€å®šæ—¶é—´å†…å¿…å®šå‡ºç°ä¸€æ¬¡ ==========

        // åŸå…ˆçš„éšæœºå‡ºç°ï¼ˆå¯ä¿ç•™æˆ–å¾®è°ƒï¼‰
        setInterval(() => {
            if (Math.random() < 0.3) {
                spawnFood();
            }
        }, 60000); // æ¯ 60 ç§’éšæœºä¸€æ¬¡

        setInterval(() => {
            if (Math.random() < 0.1) {
                spawnLife();
            }
        }, 30000); // æ¯ 30 ç§’éšæœºä¸€æ¬¡

        // æ¯ç§’æ£€æŸ¥ä¸€ä¸‹ï¼Œå¦‚æœè¶…è¿‡ 1 åˆ†é’Ÿè¿˜æ²¡å‡º foodï¼Œå°±å¼ºåˆ¶åˆ·ä¸€æ¬¡
        // å¦‚æœè¶…è¿‡ 2 åˆ†é’Ÿè¿˜æ²¡å‡º lifeï¼Œä¹Ÿå¼ºåˆ¶åˆ·ä¸€æ¬¡
        setInterval(() => {
            const now = Date.now();
            // è·ç¦»ä¸Šæ¬¡åˆ· food è¶…è¿‡ 1 åˆ†é’Ÿ
            if (now - lastFoodSpawnTime >= 60000) {
                spawnFood();
            }
            // è·ç¦»ä¸Šæ¬¡åˆ· life è¶…è¿‡ 2 åˆ†é’Ÿ
            if (now - lastLifeSpawnTime >= 120000) {
                spawnLife();
            }
        }, 1000);

        function spawnFood() {
            foods.push(new Food());
            lastFoodSpawnTime = Date.now();
        }

        function spawnLife() {
            lifes.push(new Life());
            lastLifeSpawnTime = Date.now();
        }

        // ========== éš¾åº¦å¾ªç¯ (4æ®µ) + æ•Œæœºç”Ÿæˆåˆ·æ–° ==========

        setInterval(() => {
            const elapsed = (Date.now() - cycleStartTime) / 1000;

            // 4æ®µéš¾åº¦å¾ªç¯ï¼ˆ60ç§’ä¸ºä¸€ä¸ªé˜¶æ®µï¼Œå…± 4 é˜¶æ®µ = 240ç§’ï¼‰
            if (elapsed % 240 < 60) {
                ENEMY_MIN_SPEED = 3;
                ENEMY_MAX_SPEED = 6;
                ENEMY_SPAWN_TIME = 700;
            } else if (elapsed % 240 < 120) {
                ENEMY_MIN_SPEED = 4.5;
                ENEMY_MAX_SPEED = 9;
                ENEMY_SPAWN_TIME = 500;
            } else if (elapsed % 240 < 180) {
                ENEMY_MIN_SPEED = 6.75;
                ENEMY_MAX_SPEED = 13.5;
                ENEMY_SPAWN_TIME = 350;
            } else if (elapsed % 240 < 240) {
                ENEMY_MIN_SPEED = 10;
                ENEMY_MAX_SPEED = 20;
                ENEMY_SPAWN_TIME = 200;
            }

            // åˆ‡æ¢è¡€é‡å€æ•°ï¼ˆ240ç§’åç¿»å€ï¼Œ480ç§’åæ¢å¤ï¼‰
            if (elapsed % 480 >= 240) {
                ENEMY_HEALTH_MULTIPLIER = 2;
            } else {
                ENEMY_HEALTH_MULTIPLIER = 1;
            }

            // åˆ·æ–°å°æ€ªç”Ÿæˆé—´éš”
            updateEnemySpawn();
        }, 1000);

        // ========== æ¯ 4 åˆ†é’Ÿåˆ·ä¸€ä¸ª BOSS ==========

        let bossActive = false; // è¡¨ç¤ºå½“å‰å±å¹•ä¸Šæ˜¯å¦å·²æœ‰ boss
        let bossSpawnCount = 0; // è®°å½•å·²ç»åˆ·äº†å‡ æ¬¡ boss
        function spawnBoss() {
            // å¦‚æœå±å¹•ä¸Šå·²ç»æœ‰ Bossï¼Œå°±ä¸å†ç”Ÿæˆæ–°çš„
            if (!bossActive) {
                bossActive = true;
                bossSpawnCount++; // æ¯å‡ºç°ä¸€æ¬¡ Bossï¼Œå°±åŠ  1

                // ç¬¬ 1~4 æ¬¡åˆ†åˆ«å¯¹åº”ä¸åŒé€Ÿåº¦ï¼Œç„¶åå¾ªç¯
                const cycleIndex = (bossSpawnCount - 1) % 4;
                let speedFactor;
                switch (cycleIndex) {
                    case 0: speedFactor = 1; break; // ç¬¬ä¸€æ¬¡æœ€æ…¢
                    case 1: speedFactor = 2; break; // ç¬¬äºŒæ¬¡ä¸­é€Ÿ
                    case 2: speedFactor = 3; break; // ç¬¬ä¸‰æ¬¡æ›´å¿«
                    case 3: speedFactor = 4; break; // ç¬¬å››æ¬¡æœ€å¿«
                }

                // å°† speedFactor ä¼ ç»™ Boss æ„é€ å‡½æ•°
                bosses.push(new Boss(speedFactor));
            }
        }

        setInterval(() => {
            spawnBoss();
        }, 120000); // 120000ms = 120s = 2åˆ†é’Ÿ

        // ============================== æ¸¸æˆæ§åˆ¶ï¼ˆé”®ç›˜/è§¦å±ï¼‰ ==============================
        window.addEventListener('keydown', (e) => {
            keys[e.key] = true;
            if (e.key === ' ' && !gameOver) {
                shoot();
            }
        });

        window.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });

        document.getElementById('left').addEventListener('touchstart', () => keys['ArrowLeft'] = true);
        document.getElementById('left').addEventListener('touchend', () => keys['ArrowLeft'] = false);

        document.getElementById('right').addEventListener('touchstart', () => keys['ArrowRight'] = true);
        document.getElementById('right').addEventListener('touchend', () => keys['ArrowRight'] = false);

        document.getElementById('up').addEventListener('touchstart', () => keys['ArrowUp'] = true);
        document.getElementById('up').addEventListener('touchend', () => keys['ArrowUp'] = false);

        document.getElementById('down').addEventListener('touchstart', () => keys['ArrowDown'] = true);
        document.getElementById('down').addEventListener('touchend', () => keys['ArrowDown'] = false);

        document.getElementById('shoot').addEventListener('touchstart', () => {
            if (!gameOver) shoot();
        });

        // ============================== å°„å‡»å‡½æ•° ==============================
        function shoot() {
            if (foodCount >= 2) {
                // è¶…çº§ç«åŠ›ï¼ˆä¸ƒå‘ï¼‰
                bullets.push(new Bullet(player.x + player.width / 2, player.y, -3));
                bullets.push(new Bullet(player.x + player.width / 2, player.y, -2));
                bullets.push(new Bullet(player.x + player.width / 2, player.y, -1));
                bullets.push(new Bullet(player.x + player.width / 2, player.y, 0));
                bullets.push(new Bullet(player.x + player.width / 2, player.y, 1));
                bullets.push(new Bullet(player.x + player.width / 2, player.y, 2));
                bullets.push(new Bullet(player.x + player.width / 2, player.y, 3));
            } else if (player.powerUp) {
                // ä¸‰å‘ç«åŠ›
                bullets.push(new Bullet(player.x + player.width / 2, player.y, -1));
                bullets.push(new Bullet(player.x + player.width / 2, player.y, 0));
                bullets.push(new Bullet(player.x + player.width / 2, player.y, 1));
            } else {
                // æ™®é€šç«åŠ›
                bullets.push(new Bullet(player.x + player.width / 2, player.y));
            }
        }

        // ============================== å¯åŠ¨æ¸¸æˆ ==============================
        updateEnemySpawn();
        gameLoop();

        // åœ¨ gameLoop ä¸­ï¼Œå¦‚æœ boss å…¨æ­»äº†ï¼Œå°± bossActive = false
        // ï¼ˆå·²åœ¨ boss çˆ†ç‚¸å splice ä¸­å¯åˆ¤æ–­ if(bosses.length===0) bossActive=falseï¼‰
    </script>
</body>
</html>
